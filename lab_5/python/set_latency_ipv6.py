import argparse
import subprocess
import re
import sys
from arango import ArangoClient

# Append python path search
#sys.path.append("/home/cisco/.local/lib/python3.8/site-packages")

# Variables to create ArangoDb connection
user = "root"
password = "jalapeno"
dbname = "jalapeno"
    
# Handle cli options passed in
link_options = ['A','B','C','D','E','F','G','H','I']
parser = argparse.ArgumentParser(
    prog = 'Lab Latency Creater',
        description = 'Sets latency on a single link in the lab topology',
        epilog = 'set_latency.py -l <a..i> -ms <0 -300>')
parser.add_argument("-l", choices=link_options,required=True, help="link identifier values A through I")
parser.add_argument("-ms", type=int, required=True, help="latency on link in ms")  

args = parser.parse_args()
# Map link cli input to file descriptor and create file locator
file_dict={
    'A':'xrd01-xrd02',
    'B':'xrd01-xrd05',
    'C':'xrd02-xrd06',
    'D':'xrd05-xrd04',
    'E':'xrd02-xrd03',
    'F':'xrd03-xrd04',
    'G':'xrd05-xrd06',
    'H':'xrd04-xrd07',
    'I':'xrd06-xrd07'
}

# Create a dictionary lookup of key values 
link_WtoE ={
    'A':'2_0_0_0_0000.0000.0001_10.1.1.0_0000.0000.0002_10.1.1.1',
    'B':'2_0_0_0_0000.0000.0001_10.1.1.8_0000.0000.0005_10.1.1.9',
    'C':'2_0_0_0_0000.0000.0002_10.1.1.10_0000.0000.0006_10.1.1.11',
    'D':'2_0_0_0_0000.0000.0005_10.1.1.12_0000.0000.0004_10.1.1.13',
    'E':'2_0_0_0_0000.0000.0002_10.1.1.2_0000.0000.0003_10.1.1.3',
    'F':'2_0_0_0_0000.0000.0003_10.1.1.4_0000.0000.0004_10.1.1.5',
    'G':'2_0_0_0_0000.0000.0005_10.1.1.14_0000.0000.0006_10.1.1.15',
    'H':'2_0_0_0_0000.0000.0004_10.1.1.6_0000.0000.0007_10.1.1.7'
}
link_EtoW ={
    'A':'2_0_0_0_0000.0000.0002_10.1.1.1_0000.0000.0001_10.1.1.0',
    'B':'2_0_0_0_0000.0000.0005_10.1.1.9_0000.0000.0001_10.1.1.8',
    'C':'2_0_0_0_0000.0000.0006_10.1.1.11_0000.0000.0002_10.1.1.10',
    'D':'2_0_0_0_0000.0000.0004_10.1.1.13_0000.0000.0005_10.1.1.12',
    'E':'2_0_0_0_0000.0000.0003_10.1.1.3_0000.0000.0002_10.1.1.2',
    'F':'2_0_0_0_0000.0000.0004_10.1.1.5_0000.0000.0003_10.1.1.4',
    'G':'2_0_0_0_0000.0000.0006_10.1.1.15_0000.0000.0005_10.1.1.14',
    'H':'2_0_0_0_0000.0000.0007_10.1.1.7_0000.0000.0006_10.1.1.6'
}

link_WtoE ={
    'A':'2_0_2_0_0000.0000.0001_2001:1:1:1::_0000.0000.0002_2001:1:1:1::1',
    'B':'2_0_2_0_0000.0000.0001_2001:1:1:1::8_0000.0000.0005_2001:1:1:1::9',
    'C':'2_0_2_0_0000.0000.0002_2001:1:1:1::10_0000.0000.0006_2001:1:1:1::11',
    'D':'2_0_2_0_0000.0000.0005_2001:1:1:1::12_0000.0000.0004_2001:1:1:1::13',
    'E':'2_0_2_0_0000.0000.0002_2001:1:1:1::2_0000.0000.0003_2001:1:1:1::3',
    'F':'2_0_2_0_0000.0000.0003_2001:1:1:1::4_0000.0000.0004_2001:1:1:1::5',
    'G':'2_0_2_0_0000.0000.0005_2001:1:1:1::14_0000.0000.0006_2001:1:1:1::15',
    'H':'2_0_2_0_0000.0000.0004_2001:1:1:1::6_0000.0000.0007_2001:1:1:1::7',
    'I':'2_0_2_0_0000.0000.0006_2001:1:1:1::16_0000.0000.0007_2001:1:1:1::17'
}

link_EtoW ={
    'A':'2_0_2_0_0000.0000.0002_2001:1:1:1::_0000.0000.0001_2001:1:1:1::1',
    'B':'2_0_2_0_0000.0000.0005_2001:1:1:1::9_0000.0000.0001_2001:1:1:1::8',
    'C':'2_0_2_0_0000.0000.0006_2001:1:1:1::11_0000.0000.0002_2001:1:1:1::10',
    'D':'2_0_2_0_0000.0000.0004_2001:1:1:1::13_0000.0000.0005_2001:1:1:1::12',
    'E':'2_0_2_0_0000.0000.0003_2001:1:1:1::3_0000.0000.0002_2001:1:1:1::2',
    'F':'2_0_2_0_0000.0000.0004_2001:1:1:1::5_0000.0000.0003_2001:1:1:1::4',
    'G':'2_0_2_0_0000.0000.0006_2001:1:1:1::15_0000.0000.0005_2001:1:1:1::14',
    'H':'2_0_2_0_0000.0000.0007_2001:1:1:1::7_0000.0000.0004_2001:1:1:1::6',
    'I':'2_0_2_0_0000.0000.0007_2001:1:1:1::17_0000.0000.0006_2001:1:1:1::16'
}

# Connect to ArangoDb
client = ArangoClient(hosts='http://198.18.128.101:30852')
db = client.db(dbname, username=user, password=password)

# Set the document in Arango
srt = db.collection('ipv6_graph')

# Set West to East Link Latency
record = srt.get(link_WtoE[args.l])
record['latency'] = args.ms
srt.update(record)

# Set East to West Link Latency
record = srt.get(link_EtoW[args.l])
record['latency'] = args.ms
srt.update(record)

print ("Link " + args.l + " programmed successfully for " + str(args.ms) + "ms of latency.")



